<%= form_for(@project, :url => url_for(:action => 'update', :key => @project.key)) do |f| %>
  <% if @project.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@project.errors.count, "error") %> prohibited this project from being saved:</h2>

      <ul>
      <% @project.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<div id='popup' class='hidden'>
<div id='popup_cross' onclick="$('#popup').addClass('hidden');">X</div>
<div id='popup_content'></div>
</div>


<div class="project">

<%= @user.name %>

 <table>
<tr><td>Name</td><td><%= f.text_field :name %></td></tr>
<tr><td>Description</td><td><%= f.text_field :description %></td></tr>
</table>

</div>
<div id="exp_list"></div>
<%= render :partial => 'exp_space' %>
<div id="new_exp_button" class="button">New experiment</div>
<div id="sample_list"></div>

<div class="actions">
    <%= f.submit %>
</div>
<% end %>


<%= javascript_tag do %>

var current_exp_id = <%= (exp = @project.exps.first) ? exp.id : null %> ;
$('#exp_' + current_exp_id).toggleClass('activated');

function update_exp_list(){
 $.ajax({
  url: '<%= exps_path %>?project_key=<%= @project.key %>&layout=0',
  type: "GET",
  dataType: 'html',
 }).done(function(html){
    $('#exp_list').html(html);
    update_sample_list();
 }).fail(function(){
 });
}

function update_sample_list(){

 $.ajax({
  url: '<%= index_slickgrid_samples_path %>?project_key=<%= @project.key %>&exp_id=' + current_exp_id + '&layout=0',
  type: "GET",
  dataType: 'html',
 }).done(function(html){
  // eval(responseText);
   $('#sample_list').html(html);
 }).fail(function(){
 });
}

function call_exp_form(){
 $.ajax({
  url: '<%= new_exp_path %>?project_key=<%= @project.key %>&layout=0',
  type: "GET",
  dataType: 'html',
 }).done(function(html){
    $('#popup_content').html(html);
 }).fail(function(){
 });
}

$('#new_exp_button').click(function(){
call_exp_form();
$('#popup').toggleClass('hidden');
});

update_exp_list()

<% end %>
